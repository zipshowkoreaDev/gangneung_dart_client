<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Dart Socket Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    h1 {
      margin-top: 0;
      color: #333;
    }

    h2 {
      color: #555;
      margin-top: 0;
      font-size: 18px;
    }

    .input-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #666;
    }

    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .btn-primary {
      background: #4CAF50;
      color: white;
    }

    .btn-primary:hover {
      background: #45a049;
    }

    .btn-danger {
      background: #f44336;
      color: white;
    }

    .btn-danger:hover {
      background: #da190b;
    }

    .btn-secondary {
      background: #2196F3;
      color: white;
    }

    .btn-secondary:hover {
      background: #0b7dda;
    }

    .status {
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
      font-weight: 500;
    }

    .status.connected {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status.disconnected {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status.pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .client-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }

    .client-box {
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .client-box:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }

    .client-box.active {
      border-color: #4CAF50;
      background: #f1f8f4;
    }

    .client-box .input-group {
      margin-bottom: 10px;
    }

    .client-box .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #666;
      font-size: 14px;
    }

    .client-box .input-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .client-id {
      font-family: monospace;
      font-size: 12px;
      color: #666;
      word-break: break-all;
      margin-top: 5px;
      white-space: pre-line;
    }

    .room-info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .player-count {
      font-size: 24px;
      font-weight: bold;
      color: #1976d2;
      margin: 10px 0;
    }

    .game-ready {
      background: #c8e6c9;
      color: #2e7d32;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
      display: none;
    }

    .game-ready.show {
      display: block;
    }

    .ranking-section {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .ranking-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin: 8px 0;
      background: white;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    .ranking-item.first {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      border-color: #ffc107;
      font-weight: bold;
    }

    .ranking-item.second {
      background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
      border-color: #9e9e9e;
    }

    .ranking-rank {
      font-size: 24px;
      font-weight: bold;
      margin-right: 15px;
      min-width: 40px;
    }

    .ranking-name {
      flex: 1;
      font-size: 16px;
    }

    .ranking-score {
      font-size: 20px;
      font-weight: bold;
      color: #1976d2;
    }

    .log {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      margin-top: 10px;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 3px 0;
      border-bottom: 1px solid #eee;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .timestamp {
      color: #999;
      margin-right: 8px;
    }
  </style>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>

<body>
  <div class="card">
    <h1>ğŸ¯ Dart Socket ì—°ê²° í…ŒìŠ¤íŠ¸</h1>

    <div class="input-group">
      <label>ì„œë²„ URL:</label>
      <input type="text" id="serverUrl" value="https://socket-relay.zipshowkorea.com" placeholder="https://socket-relay.zipshowkorea.com">
    </div>

    <div class="input-group">
      <label>Room ì½”ë“œ:</label>
      <input type="text" id="room" value="TEST" placeholder="TEST">
    </div>

    <div>
      <button class="btn-primary" id="connect1">í´ë¼ì´ì–¸íŠ¸ 1 ì—°ê²°</button>
      <button class="btn-primary" id="connect2">í´ë¼ì´ì–¸íŠ¸ 2 ì—°ê²°</button>
      <button class="btn-secondary" id="checkRoom">ë°© ì¸ì› í™•ì¸</button>
      <button class="btn-danger" id="disconnectAll">ëª¨ë‘ ì—°ê²° í•´ì œ</button>
      <button class="btn-primary" id="finishGame" style="background: #ff9800; border-color: #ff9800;">ê²Œì„ ì™„ë£Œ</button>
    </div>

    <div class="card" style="background: #e8f5e9; border: 2px solid #4CAF50; margin-top: 20px;">
      <h2 style="margin-top: 0; color: #2e7d32;">ğŸ® í ê´€ë¦¬ ì‹œìŠ¤í…œ (Queue Management)</h2>
      <div style="margin-bottom: 15px;">
        <button class="btn-secondary" id="statusQueue">í ìƒíƒœ í™•ì¸</button>
        <button class="btn-primary" id="joinQueue">í ì°¸ê°€</button>
        <button class="btn-danger" id="leaveQueue">í ë‚˜ê°€ê¸°</button>
        <button class="btn-danger" id="resetQueue" style="background: #ff5722;">ğŸ”„ í ì´ˆê¸°í™”</button>
      </div>
      <div style="background: #fff3cd; padding: 12px; border-radius: 6px; margin-bottom: 15px; font-size: 14px;">
        â„¹ï¸ <strong>í˜„ì¬ í™œì„± í´ë¼ì´ì–¸íŠ¸:</strong> <span id="activeClient">ì—†ìŒ</span>
      </div>
      <div class="queue-status" style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
        <h3 style="margin-top: 0; font-size: 16px; color: #555;">
          í˜„ì¬ í ìƒíƒœ
          <span id="queueCount" style="color: #4CAF50; font-weight: bold;">(0ëª…)</span>
        </h3>
        <div id="queueList" style="margin-top: 10px;"></div>
      </div>
    </div>

    <div class="client-info">
      <div class="client-box" id="client1">
        <h2>í´ë¼ì´ì–¸íŠ¸ 1</h2>
        <div class="input-group">
          <label>ì´ë¦„:</label>
          <input type="text" id="name1" placeholder="Player 1" value="Player 1" />
        </div>
        <div class="status disconnected" id="status1">ì—°ê²° ì•ˆë¨</div>
        <div class="client-id" id="clientId1">-</div>
        <div class="score-section" id="scoreSection1" style="display: none; margin-top: 15px;">
          <label style="font-weight: 500; margin-bottom: 8px; display: block;">ì ìˆ˜ ì„ íƒ:</label>
          <div class="score-buttons" style="display: flex; gap: 8px;">
            <button class="btn-score" data-client="1" data-score="50">50</button>
            <button class="btn-score" data-client="1" data-score="100">100</button>
            <button class="btn-score" data-client="1" data-score="80">80</button>
          </div>
          <div style="margin-top: 10px; font-weight: 500;">
            í˜„ì¬ ì ìˆ˜: <span id="currentScore1">0</span>
          </div>
        </div>
      </div>

      <div class="client-box" id="client2">
        <h2>í´ë¼ì´ì–¸íŠ¸ 2</h2>
        <div class="input-group">
          <label>ì´ë¦„:</label>
          <input type="text" id="name2" placeholder="Player 2" value="Player 2" />
        </div>
        <div class="status disconnected" id="status2">ì—°ê²° ì•ˆë¨</div>
        <div class="client-id" id="clientId2">-</div>
        <div class="score-section" id="scoreSection2" style="display: none; margin-top: 15px;">
          <label style="font-weight: 500; margin-bottom: 8px; display: block;">ì ìˆ˜ ì„ íƒ:</label>
          <div class="score-buttons" style="display: flex; gap: 8px;">
            <button class="btn-score" data-client="2" data-score="50">50</button>
            <button class="btn-score" data-client="2" data-score="100">100</button>
            <button class="btn-score" data-client="2" data-score="80">80</button>
          </div>
          <div style="margin-top: 10px; font-weight: 500;">
            í˜„ì¬ ì ìˆ˜: <span id="currentScore2">0</span>
          </div>
        </div>
      </div>
    </div>

    <div class="room-info">
      <h2>ë°© ì •ë³´</h2>
      <div>Room: <strong id="roomDisplay">-</strong></div>
      <div class="player-count">ì ‘ì† ì¸ì›: <span id="playerCount">0</span> / 2</div>
    </div>

    <div class="game-ready" id="gameReady">
      âœ… ê²Œì„ ì‹œì‘ ê°€ëŠ¥! (2ëª… ì ‘ì† ì™„ë£Œ)
    </div>

    <div class="ranking-section" id="rankingSection" style="display: none; margin-top: 20px;">
      <div class="card" style="background: #fff3cd; border: 2px solid #ffc107;">
        <h2 style="margin-top: 0; color: #856404;">ğŸ† ìµœì¢… ìˆœìœ„</h2>
        <div id="rankingList"></div>
      </div>
    </div>

    <div class="log" id="log"></div>
  </div>

  <script>
    // ============================================
    // ìƒíƒœ ë³€ìˆ˜ (State Variables)
    // ============================================

    // í´ë¼ì´ì–¸íŠ¸ 1, 2 ì†Œì¼“ ë° ì •ë³´
    let socket1 = null;
    let socket2 = null;
    let playerName1 = '';
    let playerName2 = '';
    let playerScore1 = 0;
    let playerScore2 = 0;
    let activeClientNum = 0; // 0: ì—†ìŒ, 1: í´ë¼ì´ì–¸íŠ¸1, 2: í´ë¼ì´ì–¸íŠ¸2

    // ë°© ì •ë³´
    let playerCount = 0;

    // í ê´€ë¦¬ìš© ë³€ìˆ˜
    let queueSockets = []; // [{ socket, name, socketId }] í˜•íƒœ
    let queueSocketCounter = 1; // ìë™ ìƒì„±ë˜ëŠ” í í”Œë ˆì´ì–´ ë²ˆí˜¸
    let selectedQueueSocketId = null; // í˜„ì¬ ì„ íƒëœ í ì†Œì¼“ ID

    // ê° ì†Œì¼“ì˜ í ìˆœì„œ ì €ì¥ (socketId -> position)
    let socketQueuePositions = new Map(); // Map<socketId, { position, total }>
    let currentQueueList = []; // í˜„ì¬ í ì „ì²´ ë¦¬ìŠ¤íŠ¸

    // ============================================
    // DOM ìš”ì†Œ ì°¸ì¡° (DOM References)
    // ============================================

    // ì…ë ¥ í•„ë“œ
    const serverUrlInput = document.getElementById('serverUrl');
    const roomInput = document.getElementById('room');
    const name1Input = document.getElementById('name1');
    const name2Input = document.getElementById('name2');

    // ë²„íŠ¼
    const connect1Btn = document.getElementById('connect1');
    const connect2Btn = document.getElementById('connect2');
    const checkRoomBtn = document.getElementById('checkRoom');
    const disconnectAllBtn = document.getElementById('disconnectAll');
    const finishGameBtn = document.getElementById('finishGame');
    const statusQueueBtn = document.getElementById('statusQueue');
    const joinQueueBtn = document.getElementById('joinQueue');
    const leaveQueueBtn = document.getElementById('leaveQueue');
    const resetQueueBtn = document.getElementById('resetQueue');

    // í‘œì‹œ ìš”ì†Œ
    const status1 = document.getElementById('status1');
    const status2 = document.getElementById('status2');
    const clientId1 = document.getElementById('clientId1');
    const clientId2 = document.getElementById('clientId2');
    const client1Box = document.getElementById('client1');
    const client2Box = document.getElementById('client2');
    const scoreSection1 = document.getElementById('scoreSection1');
    const scoreSection2 = document.getElementById('scoreSection2');
    const currentScore1 = document.getElementById('currentScore1');
    const currentScore2 = document.getElementById('currentScore2');
    const roomDisplay = document.getElementById('roomDisplay');
    const playerCountDisplay = document.getElementById('playerCount');
    const gameReady = document.getElementById('gameReady');
    const activeClient = document.getElementById('activeClient');
    const logDiv = document.getElementById('log');

    // ìˆœìœ„ ë° í ê´€ë ¨
    const rankingSection = document.getElementById('rankingSection');
    const rankingList = document.getElementById('rankingList');
    const queueList = document.getElementById('queueList');
    const queueCount = document.getElementById('queueCount');

    // ============================================
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (Utility Functions)
    // ============================================

    /**
     * ë¡œê·¸ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶œë ¥
     */
    function log(message) {
      const now = new Date();
      const timestamp = now.toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="timestamp">[${timestamp}]</span>${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    /**
     * ì—°ê²°ëœ ì†Œì¼“ ì¤‘ í•˜ë‚˜ë¥¼ ì°¾ì•„ì„œ ë°˜í™˜
     */
    function getAnyConnectedSocket() {
      if (socket1 && socket1.connected) return socket1;
      if (socket2 && socket2.connected) return socket2;
      if (queueSockets.length > 0) return queueSockets[0].socket;
      return null;
    }

    /**
     * ì†Œì¼“ IDë¡œ í•´ë‹¹ ì†Œì¼“ ì •ë³´ ì°¾ê¸°
     */
    function findSocketById(socketId) {
      if (socket1 && socket1.id === socketId) {
        return {
          socket: socket1,
          name: playerName1,
          type: 'client1'
        };
      }
      if (socket2 && socket2.id === socketId) {
        return {
          socket: socket2,
          name: playerName2,
          type: 'client2'
        };
      }
      const queueSocket = queueSockets.find(q => q.socketId === socketId);
      if (queueSocket) {
        return {
          socket: queueSocket.socket,
          name: queueSocket.name,
          type: 'queue'
        };
      }
      return null;
    }

    // ============================================
    // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (UI Update Functions)
    // ============================================

    /**
     * í ìƒíƒœ ë°ì´í„° ì—…ë°ì´íŠ¸ (ê° ì†Œì¼“ì˜ ìˆœì„œ ê³„ì‚° ë° ì €ì¥)
     */
    function updateQueueData(queueArray) {
      currentQueueList = queueArray;
      socketQueuePositions.clear();

      queueArray.forEach((socketId, index) => {
        socketQueuePositions.set(socketId, {
          position: index + 1, // 1-based index
          total: queueArray.length,
          isFirst: index === 0,
          isLast: index === queueArray.length - 1
        });
      });
    }

    /**
     * íŠ¹ì • ì†Œì¼“ì˜ í ìˆœì„œ ê°€ì ¸ì˜¤ê¸°
     */
    function getMyQueuePosition(socketId) {
      return socketQueuePositions.get(socketId);
    }

    /**
     * í ë¦¬ìŠ¤íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
     */
    function updateQueueDisplay(queueArray) {
      // í ë°ì´í„° ì—…ë°ì´íŠ¸
      updateQueueData(queueArray);

      queueCount.textContent = `(${queueArray.length}ëª…)`;

      if (queueArray.length === 0) {
        queueList.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">íê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</div>';
        selectedQueueSocketId = null;
        return;
      }

      queueList.innerHTML = '';
      queueArray.forEach((socketId, index) => {
        const queuePos = socketQueuePositions.get(socketId);
        const position = queuePos.position;
        const socketInfo = findSocketById(socketId);
        const clientName = socketInfo ? socketInfo.name : 'Unknown';
        const isMyClient = socketInfo !== null;
        const isSelected = selectedQueueSocketId === socketId;

        const item = document.createElement('div');
        item.style.cssText = `
          padding: 12px 15px;
          margin: 8px 0;
          border-radius: 8px;
          display: flex;
          align-items: center;
          justify-content: space-between;
          background: ${isSelected ? '#fff3cd' : isMyClient ? '#e8f5e9' : '#f5f5f5'};
          border: 2px solid ${isSelected ? '#ff9800' : isMyClient ? '#4CAF50' : '#ddd'};
          font-weight: ${isMyClient ? 'bold' : 'normal'};
          cursor: pointer;
          transition: all 0.2s ease;
        `;

        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        item.onclick = () => {
          selectedQueueSocketId = socketId;
          log(`ğŸ” íì—ì„œ ì†Œì¼“ ì„ íƒ: ${clientName} (${socketId})`);
          updateQueueDisplay(queueArray); // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì¬ë Œë”ë§
        };

        item.onmouseover = () => {
          if (!isSelected) {
            item.style.transform = 'translateY(-2px)';
            item.style.boxShadow = '0 4px 8px rgba(0,0,0,0.15)';
          }
        };

        item.onmouseout = () => {
          item.style.transform = 'translateY(0)';
          item.style.boxShadow = 'none';
        };

        const positionBadge = document.createElement('div');
        positionBadge.style.cssText = `
          background: ${position === 1 ? '#ffd700' : position === 2 ? '#c0c0c0' : '#cd7f32'};
          color: ${position <= 3 ? '#fff' : '#333'};
          padding: 4px 12px;
          border-radius: 20px;
          font-weight: bold;
          min-width: 40px;
          text-align: center;
          margin-right: 15px;
        `;
        positionBadge.textContent = `${position}ìœ„`;

        const info = document.createElement('div');
        info.style.cssText = 'flex: 1;';

        // ìˆœì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const queueInfo = getMyQueuePosition(socketId);
        let statusText = '';
        if (queueInfo) {
          if (queueInfo.isFirst) {
            statusText = '<span style="color: #ff9800; font-weight: bold;"> ğŸ‘‘ ë‹¤ìŒ ì°¨ë¡€</span>';
          } else {
            statusText = `<span style="color: #666;"> (ëŒ€ê¸°: ${queueInfo.position - 1}ëª… ì•)</span>`;
          }
        }

        info.innerHTML = `
          <div style="font-size: 14px;">
            ${clientName} ${isMyClient ? '(ë‚˜)' : ''} ${isSelected ? 'âœ“' : ''}${statusText}
          </div>
          <div style="font-size: 11px; color: #666; font-family: monospace;">${socketId}</div>
        `;

        item.appendChild(positionBadge);
        item.appendChild(info);
        queueList.appendChild(item);
      });
    }

    /**
     * í˜„ì¬ í™œì„±í™”ëœ í´ë¼ì´ì–¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
     */
    function updateActiveClient() {
      if (socket1 && socket1.connected) {
        activeClientNum = 1;
        activeClient.textContent = `í´ë¼ì´ì–¸íŠ¸ 1 (${playerName1})`;
        activeClient.style.color = '#2e7d32';
        activeClient.style.fontWeight = 'bold';
      } else if (socket2 && socket2.connected) {
        activeClientNum = 2;
        activeClient.textContent = `í´ë¼ì´ì–¸íŠ¸ 2 (${playerName2})`;
        activeClient.style.color = '#2e7d32';
        activeClient.style.fontWeight = 'bold';
      } else {
        activeClientNum = 0;
        activeClient.textContent = 'ì—†ìŒ';
        activeClient.style.color = '#999';
        activeClient.style.fontWeight = 'normal';
      }
    }

    /**
     * í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìƒíƒœ UI ì—…ë°ì´íŠ¸
     */
    function updateStatus(clientNum, isConnected, socketId, playerName) {
      const status = clientNum === 1 ? status1 : status2;
      const clientId = clientNum === 1 ? clientId1 : clientId2;
      const clientBox = clientNum === 1 ? client1Box : client2Box;
      const scoreSection = clientNum === 1 ? scoreSection1 : scoreSection2;

      if (isConnected) {
        status.textContent = `âœ… ì—°ê²°ë¨`;
        status.className = 'status connected';
        clientId.textContent = `ì´ë¦„: ${playerName || 'Unknown'}\nSocket ID: ${socketId}`;
        clientBox.classList.add('active');
        scoreSection.style.display = 'block';
      } else {
        status.textContent = 'âŒ ì—°ê²° ì•ˆë¨';
        status.className = 'status disconnected';
        clientId.textContent = '-';
        clientBox.classList.remove('active');
        scoreSection.style.display = 'none';
        // ì ìˆ˜ ì´ˆê¸°í™”
        if (clientNum === 1) {
          playerScore1 = 0;
          currentScore1.textContent = '0';
        } else {
          playerScore2 = 0;
          currentScore2.textContent = '0';
        }
      }

      updateActiveClient();
    }

    /**
     * í´ë¼ì´ì–¸íŠ¸ ì ìˆ˜ ì¶”ê°€ ë° ì„œë²„ì— ì „ì†¡
     */
    function updateScore(clientNum, score) {
      const room = roomInput.value.trim() || 'TEST';
      const socket = clientNum === 1 ? socket1 : socket2;
      const playerName = clientNum === 1 ? playerName1 : playerName2;
      const currentScoreElement = clientNum === 1 ? currentScore1 : currentScore2;

      if (!socket || !socket.connected) {
        log(`âŒ í´ë¼ì´ì–¸íŠ¸ ${clientNum}ê°€ ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`);
        return;
      }

      // ì ìˆ˜ ì¶”ê°€
      if (clientNum === 1) {
        playerScore1 += score;
        currentScore1.textContent = playerScore1;
      } else {
        playerScore2 += score;
        currentScore2.textContent = playerScore2;
      }

      log(`ğŸ“Š í´ë¼ì´ì–¸íŠ¸ ${clientNum} (${playerName}) ì ìˆ˜ ì¶”ê°€: ${score}ì  (ì´: ${clientNum === 1 ? playerScore1 : playerScore2}ì )`);

      // throw-dart ì´ë²¤íŠ¸ë¡œ ì„œë²„ì— ì „ì†¡
      socket.emit('throw-dart', {
        room: room.toUpperCase(),
        name: playerName,
        score: score, // ì ìˆ˜ ì¶”ê°€
        aim: {
          x: 0,
          y: 0
        }
      });
    }

    /**
     * ë°© ì •ë³´ í‘œì‹œ ì—…ë°ì´íŠ¸
     */
    function updateRoomInfo() {
      const room = roomInput.value || 'TEST';
      roomDisplay.textContent = room.toUpperCase();

      // ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ë°© ì¸ì›ì„ ê°€ì ¸ì™€ì•¼ í•˜ì§€ë§Œ,
      // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìˆ˜ë¡œ í‘œì‹œ
      let count = 0;
      if (socket1 && socket1.connected) count++;
      if (socket2 && socket2.connected) count++;

      playerCount = count;
      playerCountDisplay.textContent = count;

      if (count >= 2) {
        gameReady.classList.add('show');
      } else {
        gameReady.classList.remove('show');
      }
    }

    /**
     * í´ë¼ì´ì–¸íŠ¸ ì—°ê²°/í•´ì œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë° ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
     */
    function updateButtonText(clientNum, isConnected) {
      const button = clientNum === 1 ? connect1Btn : connect2Btn;
      button.textContent = isConnected ? `í´ë¼ì´ì–¸íŠ¸ ${clientNum} í•´ì œ` : `í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²°`;
      if (isConnected) {
        button.classList.remove('btn-primary');
        button.classList.add('btn-danger');
      } else {
        button.classList.remove('btn-danger');
        button.classList.add('btn-primary');
      }
    }

    /**
     * ìˆœìœ„ í‘œì‹œ
     */
    function showRanking() {
      const players = [];

      // ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ë§Œ ìˆœìœ„ì— í¬í•¨
      if (socket1 && socket1.connected && playerName1) {
        players.push({
          name: playerName1,
          score: playerScore1,
          clientNum: 1,
          socketId: socket1.id
        });
      }

      if (socket2 && socket2.connected && playerName2) {
        players.push({
          name: playerName2,
          score: playerScore2,
          clientNum: 2,
          socketId: socket2.id
        });
      }

      if (players.length === 0) {
        log('âš ï¸ ìˆœìœ„ë¥¼ í‘œì‹œí•  í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ì ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
      players.sort((a, b) => b.score - a.score);

      // ìˆœìœ„ í‘œì‹œ
      rankingList.innerHTML = '';
      players.forEach((player, index) => {
        const rank = index + 1;
        const rankEmoji = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰';
        const rankClass = rank === 1 ? 'first' : rank === 2 ? 'second' : '';

        const item = document.createElement('div');
        item.className = `ranking-item ${rankClass}`;
        item.innerHTML = `
          <div class="ranking-rank">${rankEmoji} ${rank}ìœ„</div>
          <div class="ranking-name">${player.name}</div>
          <div class="ranking-score">${player.score}ì </div>
        `;
        rankingList.appendChild(item);
      });

      rankingSection.style.display = 'block';
      log(`ğŸ† ìµœì¢… ìˆœìœ„ ë°œí‘œ! (ì´ ${players.length}ëª…)`);
      players.forEach((player, index) => {
        log(`${index + 1}ìœ„: ${player.name} - ${player.score}ì `);
      });

      // ìŠ¤í¬ë¡¤ì„ ìˆœìœ„ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
      rankingSection.scrollIntoView({
        behavior: 'smooth',
        block: 'nearest'
      });
    }

    // ============================================
    // í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ê´€ë¦¬ (Client Connection)
    // ============================================

    /**
     * í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í•´ì œ
     */
    function disconnectClient(clientNum) {
      if (clientNum === 1 && socket1) {
        socket1.disconnect();
        socket1 = null;
        playerName1 = '';
        updateStatus(1, false, '', '');
        updateButtonText(1, false);
        log(`í´ë¼ì´ì–¸íŠ¸ 1 ì—°ê²° í•´ì œë¨`);
        updateRoomInfo();
      } else if (clientNum === 2 && socket2) {
        socket2.disconnect();
        socket2 = null;
        playerName2 = '';
        updateStatus(2, false, '', '');
        updateButtonText(2, false);
        log(`í´ë¼ì´ì–¸íŠ¸ 2 ì—°ê²° í•´ì œë¨`);
        updateRoomInfo();
      }
    }

    /**
     * í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìƒì„± ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
     */
    function connectClient(clientNum) {
      const serverUrl = serverUrlInput.value.trim() || 'https://socket-relay.zipshowkorea.com';
      const room = roomInput.value.trim() || 'TEST';
      const nameInput = clientNum === 1 ? name1Input : name2Input;
      const playerName = nameInput.value.trim() || `Player ${clientNum}`;

      log(`í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²° ì‹œë„: ${serverUrl}/dart, room: ${room}, name: ${playerName}`);

      const socket = io(`${serverUrl}/dart`, {
        query: {
          room: room.toUpperCase(),
          name: playerName
        },
        reconnection: false,
        transports: ['websocket', 'polling']
      });

      // === ì—°ê²° ì´ë²¤íŠ¸ ===
      socket.on('connect', () => {
        log(`âœ… í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²° ì„±ê³µ! Socket ID: ${socket.id}, Name: ${playerName}`);

        if (clientNum === 1) {
          socket1 = socket;
          playerName1 = playerName;
          updateStatus(1, true, socket.id, playerName);
          updateButtonText(1, true);
        } else {
          socket2 = socket;
          playerName2 = playerName;
          updateStatus(2, true, socket.id, playerName);
          updateButtonText(2, true);
        }

        // joinRoom ì´ë²¤íŠ¸ ì „ì†¡ (ì´ë¦„ í¬í•¨)
        socket.emit('joinRoom', {
          room: room.toUpperCase(),
          name: playerName
        });
        updateRoomInfo();
      });

      // === ë°© ê´€ë ¨ ì´ë²¤íŠ¸ ===
      socket.on('joinedRoom', (data) => {
        const room = typeof data === 'string' ? data : data.room;
        const count = typeof data === 'object' && data.playerCount !== undefined ? data.playerCount : null;
        log(`âœ… í´ë¼ì´ì–¸íŠ¸ ${clientNum} ë°© ì…ì¥ ì™„ë£Œ: ${room}${count !== null ? ` (í˜„ì¬ ì¸ì›: ${count}ëª…)` : ''}`);
        if (count !== null) {
          playerCount = count;
          updateRoomInfo();
        }
      });

      socket.on('clientInfo', (data) => {
        if (data && data.socketId && data.name) {
          const currentName = clientNum === 1 ? playerName1 : playerName2;
          if (data.name !== currentName) {
            log(`â„¹ï¸ í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì •ë³´ ì—…ë°ì´íŠ¸: ì´ë¦„=${data.name}, Socket ID=${data.socketId}`);
            if (clientNum === 1) {
              playerName1 = data.name;
              updateStatus(1, true, data.socketId, data.name);
            } else {
              playerName2 = data.name;
              updateStatus(2, true, data.socketId, data.name);
            }
          }
        }
      });

      socket.on('roomPlayerCount', (data) => {
        if (data && typeof data.playerCount === 'number') {
          playerCount = data.playerCount;
          log(`ğŸ“Š ë°© ì¸ì› ì—…ë°ì´íŠ¸: ${data.playerCount}ëª…`);
          updateRoomInfo();
        }
      });

      // === ê²Œì„ í”Œë ˆì´ ì´ë²¤íŠ¸ ===
      socket.on('dart-thrown', (data) => {
        log(`ğŸ¯ ë‹¤íŠ¸ ë˜ì§: ${data.name} - ì ìˆ˜: ${data.score || 'N/A'}, Aim: ${JSON.stringify(data.aim)}`);
      });

      socket.on('game-result', (data) => {
        // ìì‹ ì˜ socketIdë¡œ ê²°ê³¼ ì°¾ê¸°
        const myResult = data.results && data.results[socket.id];
        if (myResult) {
          const resultEmoji = myResult.result === 'win' ? 'ğŸ†' : myResult.result === 'tie' ? 'ğŸ¤' : 'ğŸ˜¢';
          const resultText = myResult.result === 'win' ? 'ìŠ¹ë¦¬!' : myResult.result === 'tie' ? 'ë¬´ìŠ¹ë¶€!' : 'íŒ¨ë°°';
          log(`${resultEmoji} í´ë¼ì´ì–¸íŠ¸ ${clientNum} ê²Œì„ ê²°ê³¼: ${resultText} (${myResult.rank}ìœ„, ${myResult.score}ì )`);

          // í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
          if (clientNum === 1) {
            updateStatus(1, true, socket.id, `${playerName1} - ${resultText}`);
          } else {
            updateStatus(2, true, socket.id, `${playerName2} - ${resultText}`);
          }
        }
      });

      socket.on('game-finished', (data) => {
        log(`ğŸ® ê²Œì„ ì™„ë£Œ! ë°©: ${data.room}`);
        if (data.ranking && data.ranking.length > 0) {
          log('ìµœì¢… ìˆœìœ„:');
          data.ranking.forEach((player, index) => {
            log(`  ${index + 1}ìœ„: ${player.name} - ${player.score}ì `);
          });
        }
      });

      // === ì—ëŸ¬ ë° ì—°ê²° í•´ì œ ì´ë²¤íŠ¸ ===
      socket.on('connect_error', (error) => {
        log(`âŒ í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
        if (clientNum === 1) {
          playerName1 = '';
          updateStatus(1, false, '', '');
          updateButtonText(1, false);
        } else {
          playerName2 = '';
          updateStatus(2, false, '', '');
          updateButtonText(2, false);
        }
        updateRoomInfo();
      });

      socket.on('disconnect', () => {
        log(`âš ï¸ í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²° í•´ì œ`);
        if (clientNum === 1) {
          updateStatus(1, false, '', '');
          socket1 = null;
          playerName1 = '';
          updateButtonText(1, false);
        } else {
          updateStatus(2, false, '', '');
          socket2 = null;
          playerName2 = '';
          updateButtonText(2, false);
        }
        updateRoomInfo();
      });

      socket.on('error', (error) => {
        log(`âŒ í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—ëŸ¬: ${JSON.stringify(error)}`);
      });

      // === í ê´€ë ¨ ì´ë²¤íŠ¸ ===
      socket.on('status-queue', (queue) => {
        const queueArray = queue || [];
        log(`ğŸ“‹ í ìƒíƒœ ì—…ë°ì´íŠ¸: ${queueArray.length}ëª… ëŒ€ê¸° ì¤‘`);

        // í ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ (ì „ì—­ ë³€ìˆ˜ì— ìˆœì„œ ì €ì¥)
        updateQueueDisplay(queueArray);

        // í˜„ì¬ í´ë¼ì´ì–¸íŠ¸ì˜ ìˆœì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const myQueueInfo = getMyQueuePosition(socket.id);
        if (myQueueInfo) {
          const playerName = clientNum === 1 ? playerName1 : playerName2;
          log(`   â­ í´ë¼ì´ì–¸íŠ¸ ${clientNum} (${playerName}): ${myQueueInfo.position}ë²ˆì§¸ / ì´ ${myQueueInfo.total}ëª…`);

          if (myQueueInfo.isFirst) {
            log(`   ğŸ¥‡ ${playerName}ë‹˜ì´ ë§¨ ì• ìˆœì„œì…ë‹ˆë‹¤!`);
          }
        } else {
          log(`   â„¹ï¸ í´ë¼ì´ì–¸íŠ¸ ${clientNum}ì€ í˜„ì¬ íì— ì—†ìŠµë‹ˆë‹¤.`);
        }
      });

      socket.on('joined-queue', (data) => {
        log(`âœ… í ì°¸ê°€ ì™„ë£Œ`);
      });

      socket.on('left-queue', (data) => {
        log(`âœ… í ë‚˜ê°€ê¸° ì™„ë£Œ`);
      });

      socket.on('reset-queue', (data) => {
        log(`ğŸ”„ íê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        updateQueueDisplay([]);
        selectedQueueSocketId = null;
      });
    }

    /**
     * í´ë¼ì´ì–¸íŠ¸ ì—°ê²°/í•´ì œ í† ê¸€
     */
    function toggleClient(clientNum) {
      const isConnected = (clientNum === 1 && socket1 && socket1.connected) ||
        (clientNum === 2 && socket2 && socket2.connected);

      if (isConnected) {
        disconnectClient(clientNum);
      } else {
        connectClient(clientNum);
      }
    }

    // ============================================
    // í ê´€ë¦¬ í•¨ìˆ˜ (Queue Management)
    // ============================================

    /**
     * ìƒˆë¡œìš´ í ì†Œì¼“ ìƒì„± ë° í ì°¸ê°€
     */
    function createQueueSocket() {
      const serverUrl = serverUrlInput.value.trim() || 'https://socket-relay.zipshowkorea.com';
      const room = roomInput.value.trim() || 'TEST';
      const playerName = `Queue Player ${queueSocketCounter}`;

      log(`â• ìƒˆë¡œìš´ ì†Œì¼“ ìƒì„± ë° í ì°¸ê°€: ${playerName}`);

      const newSocket = io(`${serverUrl}/dart`, {
        query: {
          room: room.toUpperCase(),
          name: playerName
        },
        reconnection: false,
        transports: ['websocket', 'polling']
      });

      newSocket.on('connect', () => {
        log(`âœ… í ì†Œì¼“ ì—°ê²° ì„±ê³µ! Socket ID: ${newSocket.id}, Name: ${playerName}`);

        queueSockets.push({
          socket: newSocket,
          name: playerName,
          socketId: newSocket.id
        });

        queueSocketCounter++;
        newSocket.emit('join-queue');
        log(`ğŸ“ ${playerName} í ì°¸ê°€ ìš”ì²­ ì „ì†¡`);
      });

      newSocket.on('status-queue', (queue) => {
        const queueArray = queue || [];
        log(`ğŸ“‹ í ìƒíƒœ ì—…ë°ì´íŠ¸: ${queueArray.length}ëª… ëŒ€ê¸° ì¤‘`);

        // í ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ (ì „ì—­ ë³€ìˆ˜ì— ìˆœì„œ ì €ì¥)
        updateQueueDisplay(queueArray);

        // í˜„ì¬ í ì†Œì¼“ì˜ ìˆœì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const myQueueInfo = getMyQueuePosition(newSocket.id);
        if (myQueueInfo) {
          log(`   â­ ${playerName}: ${myQueueInfo.position}ë²ˆì§¸ / ì´ ${myQueueInfo.total}ëª…`);

          if (myQueueInfo.isFirst) {
            log(`   ğŸ¥‡ ${playerName}ë‹˜ì´ ë§¨ ì• ìˆœì„œì…ë‹ˆë‹¤!`);
          }
        }
      });

      newSocket.on('connect_error', (error) => {
        log(`âŒ í ì†Œì¼“ ì—°ê²° ì‹¤íŒ¨ (${playerName}): ${error.message}`);
      });

      newSocket.on('disconnect', () => {
        log(`âš ï¸ í ì†Œì¼“ ì—°ê²° í•´ì œ (${playerName})`);
        queueSockets = queueSockets.filter(q => q.socketId !== newSocket.id);
        if (selectedQueueSocketId === newSocket.id) {
          selectedQueueSocketId = null;
        }
      });

      newSocket.on('reset-queue', (data) => {
        log(`ğŸ”„ íê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤! (${playerName})`);
        updateQueueDisplay([]);
        selectedQueueSocketId = null;
      });
    }

    /**
     * ì„ íƒëœ ì†Œì¼“ì„ íì—ì„œ ì œê±°
     */
    function leaveQueueWithSelectedSocket() {
      if (!selectedQueueSocketId) {
        log('âŒ íì—ì„œ ì œê±°í•  ì†Œì¼“ì„ ì„ íƒí•˜ì„¸ìš”. (í ë¦¬ìŠ¤íŠ¸ì—ì„œ í•­ëª© í´ë¦­)');
        return;
      }

      const socketInfo = findSocketById(selectedQueueSocketId);
      if (!socketInfo || !socketInfo.socket.connected) {
        log(`âŒ ì„ íƒëœ ì†Œì¼“ì´ ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`);
        selectedQueueSocketId = null;
        return;
      }

      log(`â– ${socketInfo.name} (${selectedQueueSocketId}) í ë‚˜ê°€ê¸° ìš”ì²­`);
      socketInfo.socket.emit('leave-queue');
      selectedQueueSocketId = null;
    }

    // ============================================
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (Event Listeners)
    // ============================================

    // í´ë¼ì´ì–¸íŠ¸ ì—°ê²°/í•´ì œ ë²„íŠ¼
    connect1Btn.onclick = () => toggleClient(1);
    connect2Btn.onclick = () => toggleClient(2);

    // í´ë¼ì´ì–¸íŠ¸ ë°•ìŠ¤ í´ë¦­ - í™œì„± í´ë¼ì´ì–¸íŠ¸ ì „í™˜
    client1Box.onclick = () => {
      if (socket1 && socket1.connected) {
        activeClientNum = 1;
        updateActiveClient();
        log(`ğŸ”„ í™œì„± í´ë¼ì´ì–¸íŠ¸ë¥¼ í´ë¼ì´ì–¸íŠ¸ 1 (${playerName1})ë¡œ ì „í™˜`);
      }
    };

    client2Box.onclick = () => {
      if (socket2 && socket2.connected) {
        activeClientNum = 2;
        updateActiveClient();
        log(`ğŸ”„ í™œì„± í´ë¼ì´ì–¸íŠ¸ë¥¼ í´ë¼ì´ì–¸íŠ¸ 2 (${playerName2})ë¡œ ì „í™˜`);
      }
    };

    // ë°© ì¸ì› í™•ì¸ ë²„íŠ¼
    checkRoomBtn.onclick = () => {
      const room = roomInput.value.trim() || 'TEST';
      log(`ë°© ì¸ì› í™•ì¸ ìš”ì²­: ${room}`);

      // ì‹¤ì œë¡œëŠ” ì„œë²„ APIë¡œ ë°© ì¸ì›ì„ í™•ì¸í•´ì•¼ í•˜ì§€ë§Œ,
      // í˜„ì¬ëŠ” í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìƒíƒœë§Œ í‘œì‹œ
      updateRoomInfo();
      log(`í˜„ì¬ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸: ${playerCount}ëª…`);

      if (playerCount >= 2) {
        log('âœ… ê²Œì„ ì‹œì‘ ê°€ëŠ¥ (2ëª… ì ‘ì† ì™„ë£Œ)');
      } else {
        log(`âš ï¸ ê²Œì„ ì‹œì‘ ë¶ˆê°€ (í˜„ì¬ ${playerCount}ëª…, 2ëª… í•„ìš”)`);
      }
    };

    // ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í•´ì œ ë²„íŠ¼
    disconnectAllBtn.onclick = () => {
      log('ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í•´ì œ ì¤‘...');

      if (socket1) {
        socket1.disconnect();
        socket1 = null;
        playerName1 = '';
        updateStatus(1, false, '', '');
        updateButtonText(1, false);
      }

      if (socket2) {
        socket2.disconnect();
        socket2 = null;
        playerName2 = '';
        updateStatus(2, false, '', '');
        updateButtonText(2, false);
      }

      // í ì†Œì¼“ë“¤ë„ ëª¨ë‘ í•´ì œ
      queueSockets.forEach(queueSocket => {
        if (queueSocket.socket && queueSocket.socket.connected) {
          queueSocket.socket.disconnect();
        }
      });
      queueSockets = [];
      selectedQueueSocketId = null;

      updateRoomInfo();
      rankingSection.style.display = 'none';
      updateQueueDisplay([]);
      log('ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í•´ì œ ì™„ë£Œ (í ì†Œì¼“ í¬í•¨)');
    };

    // ê²Œì„ ì™„ë£Œ ë²„íŠ¼
    finishGameBtn.onclick = () => {
      const room = roomInput.value.trim() || 'TEST';
      const players = [];

      // ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ì˜ ì ìˆ˜ ì •ë³´ ìˆ˜ì§‘
      if (socket1 && socket1.connected && playerName1) {
        players.push({
          socketId: socket1.id,
          name: playerName1,
          score: playerScore1
        });
      }

      if (socket2 && socket2.connected && playerName2) {
        players.push({
          socketId: socket2.id,
          name: playerName2,
          score: playerScore2
        });
      }

      if (players.length === 0) {
        log('âš ï¸ ê²Œì„ ì™„ë£Œí•  í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ì„œë²„ë¡œ ê²Œì„ ì™„ë£Œ ì´ë²¤íŠ¸ ì „ì†¡
      if (socket1 && socket1.connected) {
        socket1.emit('finish-game', {
          room: room.toUpperCase(),
          scores: players
        });
      } else if (socket2 && socket2.connected) {
        socket2.emit('finish-game', {
          room: room.toUpperCase(),
          scores: players
        });
      }

      // ë¡œì»¬ ìˆœìœ„ í‘œì‹œ
      showRanking();
    };

    // ì ìˆ˜ ë²„íŠ¼ í´ë¦­
    document.querySelectorAll('.btn-score').forEach(button => {
      button.addEventListener('click', () => {
        const clientNum = parseInt(button.getAttribute('data-client'));
        const score = parseInt(button.getAttribute('data-score'));
        updateScore(clientNum, score);
      });
    });

    // í ìƒíƒœ í™•ì¸ ë²„íŠ¼
    statusQueueBtn.onclick = () => {
      const socket = getAnyConnectedSocket();
      if (!socket || !socket.connected) {
        log('âŒ ì—°ê²°ëœ ì†Œì¼“ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì†Œì¼“ì„ ì—°ê²°í•˜ê±°ë‚˜ íì— ì°¸ê°€í•˜ì„¸ìš”.');
        return;
      }
      log('ğŸ“‹ í ìƒíƒœ í™•ì¸ ìš”ì²­');
      socket.emit('status-queue');
    };

    // í ì°¸ê°€ ë²„íŠ¼ - ìƒˆë¡œìš´ ì†Œì¼“ ìƒì„±
    joinQueueBtn.onclick = () => {
      createQueueSocket();
    };

    // í ë‚˜ê°€ê¸° ë²„íŠ¼ - ì„ íƒëœ ì†Œì¼“ ì œê±°
    leaveQueueBtn.onclick = () => {
      leaveQueueWithSelectedSocket();
    };

    // í ì´ˆê¸°í™” ë²„íŠ¼
    resetQueueBtn.onclick = () => {
      const socket = getAnyConnectedSocket();
      if (!socket || !socket.connected) {
        log('âŒ ì—°ê²°ëœ ì†Œì¼“ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì†Œì¼“ì„ ì—°ê²°í•˜ê±°ë‚˜ íì— ì°¸ê°€í•˜ì„¸ìš”.');
        return;
      }

      log('ğŸ”„ í ì´ˆê¸°í™” ìš”ì²­...');

      socket.emit('reset-queue', {
        project: 'dart'
      });
    };

    // ============================================
    // ì´ˆê¸°í™” (Initialization)
    // ============================================

    log('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
    updateButtonText(1, false);
    updateButtonText(2, false);
    updateRoomInfo();
    updateQueueDisplay([]);
    updateActiveClient();
  </script>
</body>

</html>
