# 기능 명세서

Gangneung Dart 프로젝트 기능 명세 및 테스트 케이스 정의

---

## 1. 랭킹 시스템 (`lib/ranking.ts`)

### 1.1 getRankings

| 항목 | 내용 |
|------|------|
| **목적** | localStorage에서 Top 5 랭킹 조회 |
| **입력** | 없음 |
| **출력** | `RankingEntry[]` |
| **조건** | 24시간 만료 시 빈 배열 반환 |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| R-1-1 | 데이터 없음 | localStorage 비어있음 | `[]` |
| R-1-2 | 정상 조회 | 유효한 랭킹 데이터 | `RankingEntry[]` |
| R-1-3 | 만료된 데이터 | 24시간 지난 데이터 | `[]` |
| R-1-4 | 잘못된 JSON | 파싱 불가 데이터 | `[]` |

---

### 1.2 addRanking

| 항목 | 내용 |
|------|------|
| **목적** | 새 기록 추가 후 Top 5 반환 |
| **입력** | `name: string`, `score: number` |
| **출력** | `RankingEntry[]` (최대 5개) |
| **정렬** | 점수 내림차순, 동점 시 최신 우선 |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| R-2-1 | 첫 기록 추가 | `("홍길동", 100)` | 1개 엔트리 |
| R-2-2 | Top 5 유지 | 6번째 기록 추가 | 5개만 유지 |
| R-2-3 | 정렬 확인 | 낮은 점수 추가 | 점수순 정렬 |
| R-2-4 | 동점 처리 | 같은 점수 추가 | 최신이 먼저 |

---

### 1.3 clearRankings

| 항목 | 내용 |
|------|------|
| **목적** | 랭킹 데이터 삭제 |
| **입력** | 없음 |
| **출력** | `void` |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| R-3-1 | 삭제 확인 | 기존 데이터 있음 | localStorage 비어있음 |

---

## 2. 방/슬롯 시스템 (`lib/room.ts`)

### 2.1 getPlayerRoom

| 항목 | 내용 |
|------|------|
| **목적** | 플레이어 방 이름 생성 |
| **입력** | `baseRoom: string`, `playerSlot: 1 \| 2` |
| **출력** | `string` (예: `game-zipshow-player1`) |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| RM-1-1 | 슬롯 1 | `("zipshow", 1)` | `"game-zipshow-player1"` |
| RM-1-2 | 슬롯 2 | `("zipshow", 2)` | `"game-zipshow-player2"` |

---

### 2.2 getDisplayRoom

| 항목 | 내용 |
|------|------|
| **목적** | 디스플레이 방 이름 생성 |
| **입력** | `baseRoom: string` |
| **출력** | `string` (예: `game-zipshow-display`) |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| RM-2-1 | 정상 | `"zipshow"` | `"game-zipshow-display"` |

---

### 2.3 assignEmptySlot

| 항목 | 내용 |
|------|------|
| **목적** | 빈 슬롯에 할당 |
| **입력** | `room: string` |
| **출력** | `1 \| 2 \| null` |
| **조건** | 1분 후 자동 만료 |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| RM-3-1 | 빈 슬롯 | 슬롯 없음 | `1` |
| RM-3-2 | 슬롯 1 점유 | 슬롯 1 사용중 | `2` |
| RM-3-3 | 모두 점유 | 슬롯 1, 2 사용중 | `null` |
| RM-3-4 | 만료 후 재할당 | 1분 경과 | `1` |

---

### 2.4 releaseSlot

| 항목 | 내용 |
|------|------|
| **목적** | 슬롯 해제 |
| **입력** | `room: string`, `slot: 1 \| 2` |
| **출력** | `void` |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| RM-4-1 | 정상 해제 | 점유된 슬롯 | 해당 슬롯 비어있음 |
| RM-4-2 | 빈 슬롯 해제 | 비어있는 슬롯 | 에러 없음 |

---

### 2.5 extractPlayerSlot

| 항목 | 내용 |
|------|------|
| **목적** | 방 이름에서 슬롯 번호 추출 |
| **입력** | `roomName: string` |
| **출력** | `1 \| 2 \| null` |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| RM-5-1 | 플레이어1 | `"game-zipshow-player1"` | `1` |
| RM-5-2 | 플레이어2 | `"game-zipshow-player2"` | `2` |
| RM-5-3 | 디스플레이 | `"game-zipshow-display"` | `null` |
| RM-5-4 | 잘못된 형식 | `"invalid-room"` | `null` |

---

## 3. 점수 계산 시스템

### 3.1 getHitScoreFromAim

| 항목 | 내용 |
|------|------|
| **목적** | aim 좌표로 점수 계산 |
| **입력** | `aim: { x: number, y: number }` (-1 ~ 1) |
| **출력** | `number` (0, 10, 20, 30, 50) |

#### 구역 기준

| 구역 | 반지름 비율 | 점수 |
|------|-------------|------|
| Bull | ~8% | 50 |
| Inner Single | ~47% | 10 |
| Triple | ~54% | 30 |
| Outer Single | ~93% | 10 |
| Double | ~100% | 20 |
| Miss | >100% | 0 |

#### 테스트 케이스

| ID | 케이스 | 입력 (x, y) | 예상 출력 |
|----|--------|-------------|----------|
| SC-1-1 | 정중앙 (Bull) | `(0, 0)` | `50` |
| SC-1-2 | Bull 경계 | `(0.03, 0.03)` | `50` |
| SC-1-3 | Inner Single | `(0.2, 0.2)` | `10` |
| SC-1-4 | Triple 영역 | `(0.35, 0.35)` | `30` |
| SC-1-5 | Outer Single | `(0.5, 0.5)` | `10` |
| SC-1-6 | Double 영역 | `(0.65, 0.65)` | `20` |
| SC-1-7 | Miss (밖) | `(1, 1)` | `0` |
| SC-1-8 | 음수 좌표 | `(-0.5, -0.5)` | `10` |

---

## 4. 슬롯 매니저 (`hooks/useSlotManager.ts`)

### 4.1 assignSlot

| 항목 | 내용 |
|------|------|
| **목적** | 플레이어에게 슬롯 할당 |
| **입력** | `playerName: string` |
| **출력** | `1 \| 2 \| null` |
| **동작** | 순서대로 1, 2 할당 |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 출력 |
|----|--------|------|----------|
| SM-1-1 | 첫 플레이어 | `"홍길동"` | `1` |
| SM-1-2 | 두번째 플레이어 | `"김철수"` | `2` |
| SM-1-3 | 세번째 플레이어 | `"이영희"` | `null` |

---

### 4.2 releaseSlot

| 항목 | 내용 |
|------|------|
| **목적** | 플레이어 슬롯 해제 |
| **입력** | `playerName: string` |
| **출력** | `void` |
| **동작** | 해당 자리만 비움 (재배치 없음) |

#### 테스트 케이스

| ID | 케이스 | 상황 | 예상 결과 |
|----|--------|------|----------|
| SM-2-1 | 슬롯 1 해제 | 1, 2 모두 점유 | 슬롯 1만 비어있음 |
| SM-2-2 | 존재하지 않는 플레이어 | 해당 플레이어 없음 | 변화 없음 |

---

## 5. 세션 시스템 (`lib/session.ts`)

### 5.1 세션 토큰 관리

| 항목 | 내용 |
|------|------|
| **저장소** | sessionStorage |
| **유효기간** | 24시간 |
| **용도** | QR 인증 후 모바일 접근 허용 |

#### 테스트 케이스

| ID | 케이스 | 상황 | 예상 결과 |
|----|--------|------|----------|
| SS-1-1 | 토큰 저장 | 유효한 토큰 | sessionStorage에 저장 |
| SS-1-2 | 토큰 검증 | 유효한 토큰 | `true` |
| SS-1-3 | 만료된 토큰 | 24시간 경과 | `false` |
| SS-1-4 | 잘못된 토큰 | 임의 문자열 | `false` |

---

## 6. 소켓 이벤트 (`hooks/useDisplaySocket.ts`)

### 6.1 이벤트 수신

| 이벤트 | 데이터 | 동작 |
|--------|--------|------|
| `aim-update` | `{ aim, name, socketId }` | 조준점 업데이트, 플레이어 등록 |
| `dart-thrown` | `{ aim, name, score }` | 점수 계산, 다트 애니메이션 |
| `aim-off` | `{ name, socketId }` | 플레이어 제거, 랭킹 등록 |
| `game-result` | `{ ranking }` | 결과 표시 |
| `reset-queue` | - | 씬 초기화 |

### 6.2 이벤트 발신

| 이벤트 | 데이터 | 시점 |
|--------|--------|------|
| `joinRoom` | `{ room, name }` | 소켓 연결 시 |
| `finish-game` | `{ room, scores }` | 플레이어 종료 시 |

---

## 7. UI 컴포넌트

### 7.1 RankingBoard

| 항목 | 내용 |
|------|------|
| **Props** | `rankings: RankingEntry[]` |
| **표시** | 순위, 이름 (truncate), 점수 |
| **스타일** | 1위 금색, 2위 은색, 3위 동색 |

#### 테스트 케이스

| ID | 케이스 | 입력 | 예상 결과 |
|----|--------|------|----------|
| UI-1-1 | 빈 랭킹 | `[]` | "기록 없음" 표시 |
| UI-1-2 | 랭킹 표시 | 5개 엔트리 | 5개 항목 렌더링 |
| UI-1-3 | 이름 truncate | 긴 이름 | max-width 80px |

---

### 7.2 Scoreboard

| 항목 | 내용 |
|------|------|
| **Props** | `players: Map<string, PlayerScore>` |
| **표시** | 플레이어 이름, 현재 점수, 던진 횟수 |

---

### 7.3 AimOverlay

| 항목 | 내용 |
|------|------|
| **Props** | `aimPositions, playerOrder, players` |
| **표시** | 조준점 마커 (플레이어별 색상) |
| **색상** | 슬롯 1: 빨강, 슬롯 2: 파랑 |

---

## 부록: 테스트 ID 규칙

| 접두어 | 영역 |
|--------|------|
| R | Ranking (랭킹) |
| RM | Room (방/슬롯) |
| SC | Score (점수 계산) |
| SM | SlotManager (슬롯 매니저) |
| SS | Session (세션) |
| UI | UI 컴포넌트 |
| E2E | End-to-End |
